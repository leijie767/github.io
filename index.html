<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>每日运势生成系统</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #2c3e50 0%, #4a69bd 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .container {
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      color: #f1c40f;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    
    .subtitle {
      font-size: 1.2rem;
      opacity: 0.8;
    }
    
    .fortune-container {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }
    
    .fortune-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }
    
    .form-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    label {
      font-size: 1rem;
      font-weight: bold;
    }
    
    select, input {
      padding: 12px;
      border-radius: 8px;
      border: none;
      background: rgba(255, 255, 255, 0.9);
      font-size: 1rem;
    }
    
    .date-selector {
      display: flex;
      gap: 10px;
    }
    
    .date-selector select {
      flex: 1;
    }
    
    button {
      padding: 15px;
      border-radius: 8px;
      border: none;
      background: #f1c40f;
      color: #2c3e50;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    button:hover {
      background: #f39c12;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    
    .result-container {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      padding: 30px;
      margin-top: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      display: none;
    }
    
    .result-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding-bottom: 15px;
      margin-bottom: 25px;
    }
    
    .result-title {
      font-size: 1.8rem;
      color: #f1c40f;
      margin-bottom: 5px;
    }
    
    .result-date {
      font-size: 1rem;
      opacity: 0.7;
    }
    
    .result-section {
      margin-bottom: 30px;
      padding-bottom: 25px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .section-title {
      font-size: 1.4rem;
      color: #3498db;
      margin-bottom: 10px;
    }
    
    .bazi-chart {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
    }
    
    .bazi-pillar {
      text-align: center;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      width: 22%;
    }
    
    .pillar-name {
      font-size: 0.9rem;
      opacity: 0.7;
      margin-bottom: 8px;
    }
    
    .pillar-value {
      font-size: 1.6rem;
      margin-bottom: 5px;
    }
    
    .bazi-element {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.9rem;
    }
    
    .element-金 { background-color: #c0c0c0; color: #333; }
    .element-木 { background-color: #5da642; }
    .element-水 { background-color: #4a8bda; }
    .element-火 { background-color: #e05d44; }
    .element-土 { background-color: #b5873b; }
    
    .elements-chart {
      margin: 20px 0;
    }
    
    .element-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .element-name {
      width: 40px;
      text-align: center;
    }
    
    .element-bar-container {
      flex: 1;
      height: 25px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .element-bar {
      height: 100%;
      border-radius: 4px;
    }
    
    .element-value {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.9rem;
      font-weight: bold;
    }
    
    .name-grid {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }
    
    .name-char {
      width: 60px;
      text-align: center;
    }
    
    .char-value {
      font-size: 2rem;
      margin-bottom: 5px;
    }
    
    .char-strokes {
      font-size: 0.9rem;
      opacity: 0.7;
    }
    
    .name-score-container {
      text-align: center;
      margin-top: 15px;
    }
    
    .name-score-label {
      font-size: 0.9rem;
      opacity: 0.7;
      margin-bottom: 5px;
    }
    
    .name-score-value {
      font-size: 1.4rem;
      color: #f1c40f;
    }
    
    .fortune-chart {
      margin: 20px 0;
    }
    
    .fortune-item {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .fortune-label {
      width: 60px;
    }
    
    .fortune-bar-container {
      flex: 1;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
    }
    
    .fortune-bar {
      height: 100%;
      border-radius: 10px;
    }
    
    .hexagram-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }
    
    .hexagram {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .hexagram-line {
      display: flex;
      justify-content: center;
    }
    
    .line-yang {
      width: 50px;
      height: 8px;
      background-color: #f1c40f;
      border-radius: 4px;
    }
    
    .line-yin {
      width: 50px;
      height: 8px;
      background-color: #f1c40f;
      border-radius: 4px;
      position: relative;
    }
    
    .line-yin::before {
      content: "";
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: rgba(0, 0, 0, 0.5);
      top: 0;
      left: 50%;
      transform: translateX(-50%);
    }
    
    .hexagram-name {
      font-size: 1.4rem;
      color: #f1c40f;
      margin-bottom: 5px;
    }
    
    .hexagram-meaning {
      font-style: italic;
      opacity: 0.8;
      text-align: center;
    }
    
    .lucky-elements {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
    }
    
    .lucky-item {
      text-align: center;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      width: 30%;
    }
    
    .lucky-title {
      font-size: 0.9rem;
      opacity: 0.7;
      margin-bottom: 10px;
    }
    
    .lucky-value {
      font-size: 1.2rem;
      color: #f1c40f;
    }
    
    .loading-container {
      text-align: center;
      padding: 40px 0;
    }
    
    .loading-animation {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      border-top-color: #f1c40f;
      animation: spin 1s linear infinite;
    }
    
    .loading-text {
      margin-top: 15px;
      font-size: 1.1rem;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    footer {
      text-align: center;
      margin-top: 50px;
      opacity: 0.7;
      font-size: 0.9rem;
    }
    
    @media (max-width: 600px) {
      h1 {
        font-size: 2rem;
      }
      
      .fortune-container {
        padding: 20px;
      }
      
      .date-selector {
        flex-direction: column;
      }
    }
    
    .line-yin-part {
      width: 20px;
      height: 8px;
      background-color: #f1c40f;
      border-radius: 4px;
      margin: 0 3px;
    }
    
    .hexagram-line {
      display: flex;
      justify-content: center;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>每日运势生成系统</h1>
      <p class="subtitle">探索你的今日运势，把握每一天的好运</p>
    </header>
    
    <div class="fortune-container">
      <div class="form-section">
        <h2 class="form-title">个人信息</h2>
        <div class="form-group">
          <label for="last-name">姓氏</label>
          <input type="text" id="last-name" placeholder="输入您的姓" required>
        </div>
        <div class="form-group">
          <label for="first-name">名字</label>
          <input type="text" id="first-name" placeholder="输入您的名" required>
        </div>
        <div class="form-group">
          <label>出生日期和时间</label>
          <div class="birth-time">
            <select id="birth-year" required>
              <option value="">年</option>
            </select>
            <select id="birth-month" required>
              <option value="">月</option>
            </select>
            <select id="birth-day" required>
              <option value="">日</option>
            </select>
            <select id="birth-hour">
              <option value="">时</option>
            </select>
          </div>
        </div>
        <button id="generate-btn" type="button">生成命运解析</button>
      </div>
      
      <div class="loading-container" id="loading-container">
        <div class="loading-animation"></div>
        <div class="loading-text">正在推算命运轨迹，请稍候...</div>
      </div>
      
      <div class="result-container" id="result-container">
        <div class="result-header">
          <div class="result-title">
            <span id="result-name">姓名</span>的命运解析
          </div>
          <div class="result-date">出生时间：<span id="result-date">--</span></div>
        </div>
        
        <div class="result-content">
          <!-- 八字命盘 -->
          <div class="result-section">
            <h3 class="section-title">生辰八字</h3>
            <p>您的生辰八字及五行属性分析</p>
            
            <div class="bazi-chart">
              <div class="bazi-pillar">
                <div class="pillar-name">年柱</div>
                <div class="pillar-value" id="year-pillar">甲子</div>
                <div class="bazi-element" id="year-element">木</div>
              </div>
              <div class="bazi-pillar">
                <div class="pillar-name">月柱</div>
                <div class="pillar-value" id="month-pillar">乙丑</div>
                <div class="bazi-element" id="month-element">木</div>
              </div>
              <div class="bazi-pillar">
                <div class="pillar-name">日柱</div>
                <div class="pillar-value" id="day-pillar">丙寅</div>
                <div class="bazi-element" id="day-element">火</div>
              </div>
              <div class="bazi-pillar">
                <div class="pillar-name">时柱</div>
                <div class="pillar-value" id="hour-pillar">丁卯</div>
                <div class="bazi-element" id="hour-element">火</div>
              </div>
            </div>
            
            <p id="bazi-analysis">您的八字命盘显示五行中木气旺盛，具有较强的创造力和进取心，性格温和坚韧。日主天干为丙火，表示您性格热情开朗，富有活力与领导才能。</p>
          </div>
          
          <!-- 五行分析 -->
          <div class="result-section">
            <h3 class="section-title">五行分布</h3>
            <p>您命盘中五行元素的分布情况</p>
            
            <div class="elements-chart">
              <div class="element-item">
                <div class="element-name">金</div>
                <div class="element-bar-container">
                  <div class="element-bar element-金" style="width: 25%"></div>
                  <div class="element-value" id="metal-percentage">25%</div>
                </div>
              </div>
              <div class="element-item">
                <div class="element-name">木</div>
                <div class="element-bar-container">
                  <div class="element-bar element-木" style="width: 35%"></div>
                  <div class="element-value" id="wood-percentage">35%</div>
                </div>
              </div>
              <div class="element-item">
                <div class="element-name">水</div>
                <div class="element-bar-container">
                  <div class="element-bar element-水" style="width: 15%"></div>
                  <div class="element-value" id="water-percentage">15%</div>
                </div>
              </div>
              <div class="element-item">
                <div class="element-name">火</div>
                <div class="element-bar-container">
                  <div class="element-bar element-火" style="width: 10%"></div>
                  <div class="element-value" id="fire-percentage">10%</div>
                </div>
              </div>
              <div class="element-item">
                <div class="element-name">土</div>
                <div class="element-bar-container">
                  <div class="element-bar element-土" style="width: 15%"></div>
                  <div class="element-value" id="earth-percentage">15%</div>
                </div>
              </div>
            </div>
            
            <p id="five-element-analysis">您的命盘中木气较为旺盛，表现为创造力和进取心强，性格温和有韧性。而火气较为不足，可能需要在热情和表达能力方面多加培养。建议通过增加红色装饰或多参与社交活动来增强火的能量。</p>
          </div>
          
          <!-- 姓名分析 -->
          <div class="result-section">
            <h3 class="section-title">姓名数理</h3>
            <p>您的姓名蕴含的数理能量分析</p>
            
            <div class="name-analysis">
              <div id="name-grid" class="name-grid">
                <!-- 这里会由JS动态生成姓名的汉字和笔画 -->
              </div>
              
              <div class="name-score-container">
                <div class="name-score-label">姓名评分</div>
                <div class="name-score-value" id="name-score">86分</div>
              </div>
            </div>
            
            <p id="name-analysis">您的姓名数理颇佳，天格、人格、地格和总格之间关系和谐，有助于事业发展和人际关系。姓名中的字义也与您的八字相配，能够起到相辅相成的作用。</p>
          </div>
          
          <!-- 星座特质 -->
          <div class="result-section">
            <h3 class="section-title">星座特质</h3>
            <p>西方占星学中的星座特质与生辰八字结合的综合分析</p>
            
            <p id="zodiac-analysis">您属于金牛座，稳重踏实，有耐心，追求物质安全感，与您八字中的土元素相互呼应，增强了您的稳定性和执着特质。在事业方面，适合从事财务、艺术、农业等领域。</p>
          </div>
          
          <!-- 运势预测 -->
          <div class="result-section">
            <h3 class="section-title">运势图表</h3>
            <p>根据八字命盘和星座特质，为您呈现各方面运势的强弱</p>
            
            <div class="fortune-chart">
              <div class="fortune-item">
                <div class="fortune-label">事业运</div>
                <div class="fortune-bar-container">
                  <div class="fortune-bar" id="career-fortune" style="width: 75%; background-color: #4a8bda;"></div>
                </div>
              </div>
              <div class="fortune-item">
                <div class="fortune-label">财富运</div>
                <div class="fortune-bar-container">
                  <div class="fortune-bar" id="wealth-fortune" style="width: 65%; background-color: #b5873b;"></div>
                </div>
              </div>
              <div class="fortune-item">
                <div class="fortune-label">感情运</div>
                <div class="fortune-bar-container">
                  <div class="fortune-bar" id="love-fortune" style="width: 80%; background-color: #e05d44;"></div>
                </div>
              </div>
              <div class="fortune-item">
                <div class="fortune-label">健康运</div>
                <div class="fortune-bar-container">
                  <div class="fortune-bar" id="health-fortune" style="width: 70%; background-color: #5da642;"></div>
                </div>
              </div>
              <div class="fortune-item">
                <div class="fortune-label">人际运</div>
                <div class="fortune-bar-container">
                  <div class="fortune-bar" id="social-fortune" style="width: 85%; background-color: #c0c0c0;"></div>
                </div>
              </div>
            </div>
            
            <p id="fortune-analysis">总体来说，您近期的运势以人际关系和感情方面表现最为突出。事业运势稳定上升，可能会有新的机遇。财富运虽不是最突出，但也处于良好状态，适合稳健投资。健康方面需要多加注意休息。</p>
          </div>
          
          <!-- 易经卦象 -->
          <div class="result-section">
            <h3 class="section-title">易经卦象解析</h3>
            <p>根据生辰信息计算出的当前卦象及含义</p>
            
            <div class="hexagram-container">
              <div class="hexagram" id="hexagram">
                <!-- 这里会由JS动态生成卦象 -->
              </div>
              <div class="hexagram-name" id="hexagram-name">解卦</div>
              <div class="hexagram-meaning" id="hexagram-meaning">解：利西南，无所往，其来复吉。有攸往，夙吉。</div>
            </div>
            
            <p id="hexagram-analysis">当前卦象为"解卦"，代表解除、化解。预示您目前正在或即将摆脱困境，走向更为顺畅的阶段。事业上的障碍将会逐渐消除，人际关系的紧张状态也会缓和。建议保持开放的心态，勇于面对变化，积极调整自己的策略和方向。</p>
          </div>
          
          <!-- 幸运元素 -->
          <div class="result-section">
            <h3 class="section-title">幸运元素</h3>
            <p>基于您的命盘特点，为您推荐的吉祥元素</p>
            
            <div class="lucky-elements">
              <div class="lucky-item">
                <div class="lucky-title">幸运色</div>
                <div class="lucky-value" id="lucky-color">金色、白色</div>
              </div>
              <div class="lucky-item">
                <div class="lucky-title">幸运数字</div>
                <div class="lucky-value" id="lucky-number">6, 9</div>
              </div>
              <div class="lucky-item">
                <div class="lucky-title">幸运方位</div>
                <div class="lucky-value" id="lucky-direction">西北</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <footer>
      <p>© 2024 每日运势生成系统 | 仅供娱乐，请勿当真</p>
    </footer>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化表单
      initializeForm();
      
      // 点击生成按钮
      document.getElementById('generate-btn').addEventListener('click', generateFortune);
    });
    
    // 初始化表单
    function initializeForm() {
      // 生成年份选项（1950-当前年份）
      const yearSelect = document.getElementById('birth-year');
      const currentYear = new Date().getFullYear();
      for (let year = 1950; year <= currentYear; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year + '年';
        yearSelect.appendChild(option);
      }
      
      // 生成月份选项
      const monthSelect = document.getElementById('birth-month');
      for (let month = 1; month <= 12; month++) {
        const option = document.createElement('option');
        option.value = month;
        option.textContent = month + '月';
        monthSelect.appendChild(option);
      }
      
      // 生成小时选项
      const hourSelect = document.getElementById('birth-hour');
      for (let hour = 0; hour <= 23; hour++) {
        const option = document.createElement('option');
        option.value = hour;
        option.textContent = hour + '时';
        hourSelect.appendChild(option);
      }
      
      // 默认选择当前年月
      yearSelect.value = currentYear;
      monthSelect.value = new Date().getMonth() + 1;
      
      // 年份和月份变化时更新日期选项
      yearSelect.addEventListener('change', updateDays);
      monthSelect.addEventListener('change', updateDays);
      
      // 初始加载日期
      updateDays();
    }
    
    // 更新日期下拉菜单
    function updateDays() {
      const year = parseInt(document.getElementById('birth-year').value) || new Date().getFullYear();
      const month = parseInt(document.getElementById('birth-month').value) || 1;
      const daySelect = document.getElementById('birth-day');
      
      // 清空现有选项
      daySelect.innerHTML = '';
      
      // 获取当前月的天数
      const daysInMonth = new Date(year, month, 0).getDate();
      
      // 填充日期选项
      for (let day = 1; day <= daysInMonth; day++) {
        const option = document.createElement('option');
        option.value = day;
        option.textContent = day + '日';
        daySelect.appendChild(option);
      }
    }
    
    // 天干
    const heavenlyStems = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
    
    // 地支
    const earthlyBranches = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
    
    // 地支对应的生肖
    const zodiacSigns = ["鼠", "牛", "虎", "兔", "龙", "蛇", "马", "羊", "猴", "鸡", "狗", "猪"];
    
    // 五行
    const fiveElements = ["金", "木", "水", "火", "土"];
    
    // 五行颜色
    const elementColors = {
      "金": "#c0c0c0",
      "木": "#5da642",
      "水": "#4a8bda",
      "火": "#e05d44",
      "土": "#b5873b"
    };
    
    // 天干对应的五行
    const stemElements = {
      "甲": "木", "乙": "木",
      "丙": "火", "丁": "火",
      "戊": "土", "己": "土",
      "庚": "金", "辛": "金",
      "壬": "水", "癸": "水"
    };
    
    // 地支对应的五行
    const branchElements = {
      "子": "水", "丑": "土",
      "寅": "木", "卯": "木",
      "辰": "土", "巳": "火",
      "午": "火", "未": "土",
      "申": "金", "酉": "金",
      "戌": "土", "亥": "水"
    };
    
    // 星座
    function getZodiacSign(month, day) {
      const dates = [20, 19, 21, 20, 21, 22, 23, 23, 23, 24, 22, 22];
      const signs = ["水瓶座", "双鱼座", "白羊座", "金牛座", "双子座", "巨蟹座", 
                    "狮子座", "处女座", "天秤座", "天蝎座", "射手座", "摩羯座"];
      
      return day < dates[month - 1] ? signs[month - 1] : signs[month % 12];
    }
    
    // 计算农历年的天干地支
    function getLunarYear(year) {
      const heavenlyStemIndex = (year - 4) % 10;
      const earthlyBranchIndex = (year - 4) % 12;
      
      return {
        stem: heavenlyStems[heavenlyStemIndex],
        branch: earthlyBranches[earthlyBranchIndex],
        zodiac: zodiacSigns[earthlyBranchIndex]
      };
    }
    
    // 简化的月干支计算（实际应考虑节气）
    function getLunarMonth(year, month) {
      const baseIndex = (year - 1900) * 12 + month - 1;
      const stemIndex = (baseIndex + 2) % 10;
      const branchIndex = month % 12 || 12;
      
      return {
        stem: heavenlyStems[stemIndex],
        branch: earthlyBranches[branchIndex - 1]
      };
    }
    
    // 简化的日干支计算
    function getLunarDay(year, month, day) {
      const baseDate = new Date(1900, 0, 31);
      const targetDate = new Date(year, month - 1, day);
      const daysDiff = Math.floor((targetDate - baseDate) / (24 * 60 * 60 * 1000));
      
      const stemIndex = daysDiff % 10;
      const branchIndex = daysDiff % 12;
      
      return {
        stem: heavenlyStems[stemIndex],
        branch: earthlyBranches[branchIndex]
      };
    }
    
    // 时辰干支计算
    function getLunarHour(dayTg, hour) {
      let hourBranchIndex;
      
      if (hour >= 23 || hour < 1) hourBranchIndex = 0; // 子时
      else hourBranchIndex = Math.floor((hour + 1) / 2) % 12;
      
      const dayTgIndex = heavenlyStems.indexOf(dayTg);
      const baseHourTg = [0, 2, 4, 6, 8][dayTgIndex % 5];
      const hourTgIndex = (baseHourTg + hourBranchIndex) % 10;
      
      return {
        stem: heavenlyStems[hourTgIndex],
        branch: earthlyBranches[hourBranchIndex]
      };
    }
    
    // 计算五行分布
    function calculateFiveElementsDistribution(yearPillar, monthPillar, dayPillar, hourPillar) {
      const elements = {
        "金": 0,
        "木": 0,
        "水": 0,
        "火": 0,
        "土": 0
      };
      
      // 天干五行
      elements[stemElements[yearPillar.stem]] += 1;
      elements[stemElements[monthPillar.stem]] += 1;
      elements[stemElements[dayPillar.stem]] += 1;
      elements[stemElements[hourPillar.stem]] += 1;
      
      // 地支五行
      elements[branchElements[yearPillar.branch]] += 1;
      elements[branchElements[monthPillar.branch]] += 1;
      elements[branchElements[dayPillar.branch]] += 1;
      elements[branchElements[hourPillar.branch]] += 1;
      
      const total = 8; // 总共8个字
      const percentages = {};
      
      for (const element in elements) {
        percentages[element] = Math.round((elements[element] / total) * 100);
      }
      
      return percentages;
    }
    
    // 修改 calculateNameNumerology 函数，增强姓名笔画分析
    function calculateNameNumerology(name) {
      // 常用汉字笔画数映射表（简化版）
      const strokeMap = {
        '李': 7, '王': 4, '张': 11, '刘': 8, '陈': 10, '杨': 7, '黄': 12, '赵': 9,
        '吴': 7, '周': 8, '徐': 10, '孙': 10, '马': 10, '朱': 6, '胡': 9, '林': 8,
        '郭': 11, '何': 7, '高': 10, '罗': 8, '郑': 9, '梁': 11, '谢': 12, '宋': 7,
        '唐': 10, '许': 11, '韩': 13, '冯': 12, '邓': 8, '曹': 11, '彭': 12, '曾': 12,
        '萧': 12, '田': 5, '董': 12, '袁': 10, '潘': 15, '于': 3, '蒋': 13, '蔡': 15,
        '余': 7, '杜': 7, '叶': 5, '程': 12, '苏': 10, '魏': 15, '吕': 6, '丁': 2,
        '任': 6, '沈': 8, '姚': 9, '卢': 7, '姜': 10, '崔': 11, '钟': 9, '谭': 13,
        '陆': 7, '汪': 8, '范': 8, '金': 8, '石': 5, '廖': 13, '贾': 11, '夏': 10,
        '韦': 9, '付': 5, '方': 4, '白': 5, '邹': 12, '孟': 8, '熊': 13, '秦': 10,
        '邱': 7, '江': 6, '尹': 4, '薛': 15, '闫': 12, '段': 9, '雷': 13, '侯': 9,
        '龙': 7, '史': 5, '陶': 11, '黎': 15, '贺': 10, '顾': 10, '毛': 4, '郝': 10,
        '龚': 9, '邵': 8, '万': 3, '钱': 10, '严': 7, '赖': 13, '覃': 12, '洪': 9,
        '武': 8, '莫': 11, '孔': 8, '戴': 17, '向': 6, '常': 11, '庄': 6, '阮': 7,
        '乐': 5, '于': 3, '时': 10, '倪': 10, '皮': 5, '卜': 2, '齐': 14, '康': 11,
        '伍': 6, '余': 7, '元': 4, '卓': 8, '古': 5, '汤': 12, '涂': 11, '尚': 8,
        '佘': 8, '巫': 7, '羊': 7, '焦': 12, '柳': 9, '季': 8, '祝': 9, '纪': 6,
        '舒': 13, '牛': 4, '阎': 14, '洋': 9, '游': 12, '冷': 7, '慕': 14, '水': 4
      };

      // 汉字五行属性映射表
      const elementMap = {
        1: "水", 2: "火", 3: "木", 4: "金", 5: "土",
        6: "水", 7: "火", 8: "木", 9: "金", 10: "土",
        11: "水", 12: "火", 13: "木", 14: "金", 15: "土",
        16: "水", 17: "火", 18: "木", 19: "金", 20: "土",
        21: "水", 22: "火", 23: "木", 24: "金", 25: "土",
        26: "水", 27: "火", 28: "木", 29: "金", 30: "土"
      };
      
      // 计算姓名每个字的笔画
      const strokes = [];
      let totalStrokes = 0;
      
      for (let i = 0; i < name.length; i++) {
        const char = name[i];
        // 如果字在映射表中，使用映射值，否则使用随机值（3-15）
        const stroke = strokeMap[char] || Math.floor(Math.random() * 13) + 3;
        strokes.push(stroke);
        totalStrokes += stroke;
      }
      
      // 根据笔画总数计算五行属性
      const nameElement = elementMap[totalStrokes % 30 + 1];
      
      // 根据笔画总数计算姓名评分（60-98分）
      const baseScore = 60;
      const randomFactor = (totalStrokes * 7) % 19;
      const score = baseScore + randomFactor + strokes.length * 5;
      
      // 根据总笔画数生成分析文本
      let analysis = "";
      
      if (totalStrokes % 6 === 0) {
        analysis = "您的姓名数理和谐，格局稳定，具有较强的领导能力和社交才能，事业发展顺利，晚年富足。";
      } else if (totalStrokes % 6 === 1) {
        analysis = "您的姓名数理显示您聪明灵活，思维敏捷，适合从事需要创新的工作，但需注意情绪管理。";
      } else if (totalStrokes % 6 === 2) {
        analysis = "您的姓名数理表明您性格沉稳，做事踏实，有较强的执行力，适合长期稳定发展的事业。";
      } else if (totalStrokes % 6 === 3) {
        analysis = "您的姓名数理暗示您具有艺术天赋和创造力，适合从事艺术、设计等相关工作，贵人运佳。";
      } else if (totalStrokes % 6 === 4) {
        analysis = "您的姓名数理表现出较强的财运和事业心，善于把握机会，适合商业和管理工作。";
      } else {
        analysis = "您的姓名数理体现出较强的人际关系能力，善解人意，具有亲和力，适合服务性行业。";
      }
      
      return {
        strokes: strokes,
        totalStrokes: totalStrokes,
        nameElement: nameElement,
        score: score > 98 ? 98 : score,
        analysis: analysis
      };
    }
    
    // 添加根据笔画生成卦象的函数
    function generateHexagramFromStrokes(totalStrokes) {
      const hexagrams = [
        {
          name: "乾卦",
          meaning: "乾：元，亨，利，贞。",
          analysis: "乾卦象征天，代表刚健、创造、领导。您将展现出坚强的意志力和领导才能，事业上可能会有重要突破。保持坚韧不拔的态度，适时把握机遇，将获得成功。"
        },
        {
          name: "坤卦",
          meaning: "坤：元，亨，利牝马之贞。",
          analysis: "坤卦象征地，代表包容、顺从、厚德载物。您需要保持谦逊的态度，适当顺应时势，不急于求成。通过勤勉踏实的努力，终将获得丰厚的回报。"
        },
        {
          name: "震卦",
          meaning: "震：亨。震来虩虩，笑言哑哑。震惊百里，不丧匕鬯。",
          analysis: "震卦象征雷，代表行动、震动、新生。您正处于变革的时期，可能会遇到突发事件或新的机遇。保持警觉和适应性，勇于面对变化，将能够获得新的突破。"
        },
        {
          name: "艮卦",
          meaning: "艮：艮其背，不获其身，行其庭，不见其人，无咎。",
          analysis: "艮卦象征山，代表稳固、停止、内省。当前您需要适当停下脚步，反省内心，稳定基础。避免盲目前进，适时休整将为未来发展积蓄力量。"
        },
        {
          name: "离卦",
          meaning: "离：利贞，亨。畜牝牛，吉。",
          analysis: "离卦象征火，代表光明、文明、附着。您将在思想和表达方面展现才华，适合从事创作、教育等工作。保持内心明亮，理性判断，将获得他人认可。"
        },
        {
          name: "坎卦",
          meaning: "坎：习坎，有孚，维心亨，行有尚。",
          analysis: "坎卦象征水，代表险难、隐伏、智慧。您可能正面临一些挑战或困境，需要谨慎前行。通过冷静思考和智慧应对，终将渡过难关，获得成长。"
        },
        {
          name: "兑卦",
          meaning: "兑：亨，利贞。",
          analysis: "兑卦象征泽，代表喜悦、满足、交流。您在人际关系方面将获得良好发展，善于表达和沟通。保持愉悦的心态，增进与他人的交流，将带来幸福和满足。"
        },
        {
          name: "巽卦",
          meaning: "巽：小亨，利有攸往，利见大人。",
          analysis: "巽卦象征风，代表顺从、谦逊、渐进。您需要保持柔和的态度，顺应环境变化，不急功近利。通过循序渐进的方式，逐步实现目标，终将取得成功。"
        }
      ];
      
      // 根据笔画总数选择卦象
      const index = totalStrokes % 8;
      return hexagrams[index];
    }
    
    // 根据姓名笔画生成幸运元素
    function getLuckyElementsFromStrokes(totalStrokes, nameElement) {
      // 根据姓名五行属性确定幸运色
      const elementColors = {
        "金": ["白色", "金色", "银色"],
        "木": ["绿色", "青色", "蓝绿色"],
        "水": ["蓝色", "黑色", "灰色"],
        "火": ["红色", "紫色", "粉色"],
        "土": ["黄色", "棕色", "土黄色"]
      };
      
      // 根据总笔画确定幸运数字
      const luckyNumber = ((totalStrokes % 9) + 1) + ", " + ((totalStrokes * 2 % 9) + 1);
      
      // 根据总笔画确定幸运方位
      const directions = ["东", "南", "西", "北", "东南", "东北", "西南", "西北"];
      const directionIndex = totalStrokes % 8;
      
      return {
        color: elementColors[nameElement].join("、"),
        number: luckyNumber,
        direction: directions[directionIndex]
      };
    }
    
    // 修改生成运势函数，使用姓名笔画数据
    function generateFortuneFromStrokes(totalStrokes, nameElement) {
      // 根据总笔画和五行属性计算各方面运势
      const baseValue = 65;  // 基础值
      
      // 使用笔画数作为种子生成不同运势分数
      const career = baseValue + (totalStrokes * 3) % 25;
      const wealth = baseValue + (totalStrokes * 5) % 25;
      const love = baseValue + (totalStrokes * 7) % 25;
      const health = baseValue + (totalStrokes * 2) % 25;
      const social = baseValue + (totalStrokes * 4) % 25;
      
      // 根据五行调整某些运势
      let adjustedFortune = {
        career: career,
        wealth: wealth,
        love: love,
        health: health,
        social: social
      };
      
      // 根据五行属性进行运势调整
      if (nameElement === "金") {
        adjustedFortune.career += 5;
        adjustedFortune.wealth += 8;
      } else if (nameElement === "木") {
        adjustedFortune.health += 5;
        adjustedFortune.social += 5;
      } else if (nameElement === "水") {
        adjustedFortune.career += 5;
        adjustedFortune.social += 8;
      } else if (nameElement === "火") {
        adjustedFortune.love += 8;
        adjustedFortune.social += 5;
      } else if (nameElement === "土") {
        adjustedFortune.wealth += 5;
        adjustedFortune.health += 5;
      }
      
      // 确保不超过100
      for (let key in adjustedFortune) {
        if (adjustedFortune[key] > 98) adjustedFortune[key] = 98;
      }
      
      return adjustedFortune;
    }
    
    // 添加此函数到JavaScript代码中
    function renderHexagram(hexagramName) {
      // 八卦基本定义
      const hexagramLines = {
        "乾卦": [1, 1, 1, 1, 1, 1], // 全阳
        "坤卦": [0, 0, 0, 0, 0, 0], // 全阴
        "震卦": [0, 0, 1, 1, 1, 1],
        "艮卦": [1, 0, 0, 1, 0, 0],
        "离卦": [1, 0, 1, 1, 0, 1],
        "坎卦": [0, 1, 0, 0, 1, 0],
        "兑卦": [1, 1, 1, 0, 1, 0],
        "巽卦": [1, 1, 0, 1, 1, 0]
      };
      
      // 获取卦象的爻
      const lines = hexagramLines[hexagramName] || [1, 0, 1, 0, 1, 0]; // 默认卦象
      
      // 获取卦象容器
      const hexagramContainer = document.getElementById('hexagram');
      hexagramContainer.innerHTML = '';
      
      // 从下到上渲染六爻
      for (let i = 5; i >= 0; i--) {
        const lineDiv = document.createElement('div');
        lineDiv.className = 'hexagram-line';
        
        if (lines[i] === 1) {
          // 阳爻
          const yangLine = document.createElement('div');
          yangLine.className = 'line-yang';
          lineDiv.appendChild(yangLine);
        } else {
          // 阴爻
          const yinLine1 = document.createElement('div');
          yinLine1.className = 'line-yin-part';
          
          const yinLine2 = document.createElement('div');
          yinLine2.className = 'line-yin-part';
          
          lineDiv.appendChild(yinLine1);
          lineDiv.appendChild(yinLine2);
        }
        
        hexagramContainer.appendChild(lineDiv);
      }
    }
    
    // 可以添加此函数来增强错误处理
    function safeUpdateElement(elementId, property, value) {
      const element = document.getElementById(elementId);
      if (element) {
        if (property === 'textContent') {
          element.textContent = value;
        } else if (property === 'className') {
          element.className = value;
        } else if (property === 'style.width') {
          element.style.width = value;
        }
      } else {
        console.warn(`Element with ID ${elementId} not found`);
      }
    }
    
    // 生成运势
    function generateFortune() {
      // 获取用户输入
      const lastName = document.getElementById('last-name').value.trim();
      const firstName = document.getElementById('first-name').value.trim();
      const year = parseInt(document.getElementById('birth-year').value);
      const month = parseInt(document.getElementById('birth-month').value);
      const day = parseInt(document.getElementById('birth-day').value);
      const hour = parseInt(document.getElementById('birth-hour').value) || 12;
      
      // 检查必填项
      if (!lastName || !firstName || !year || !month || !day) {
        alert('请填写完整的姓名和出生信息！');
        return;
      }
      
      // 显示加载动画
      document.getElementById('loading-container').style.display = 'block';
      document.getElementById('result-container').style.display = 'none';
      
      // 模拟加载延迟
      setTimeout(function() {
        try {
          // 隐藏加载动画
          document.getElementById('loading-container').style.display = 'none';
          
          // 计算生辰八字
          const yearPillar = getLunarYear(year);
          const monthPillar = getLunarMonth(year, month);
          const dayPillar = getLunarDay(year, month, day);
          const hourPillar = getLunarHour(dayPillar.stem, hour);
          
          // 计算五行分布
          const elementPercentages = calculateFiveElementsDistribution(yearPillar, monthPillar, dayPillar, hourPillar);
          
          // 获取星座
          const zodiac = getZodiacSign(month, day);
          
          // 获取主导五行
          const dominantElement = Object.keys(elementPercentages).reduce((a, b) => 
            elementPercentages[a] > elementPercentages[b] ? a : b
          );
          
          // 姓名分析
          const fullName = lastName + firstName;
          const nameAnalysis = calculateNameNumerology(fullName);
          const totalStrokes = nameAnalysis.totalStrokes;
          const nameElement = nameAnalysis.nameElement;
          
          // 生成基于笔画的运势
          const fortune = generateFortuneFromStrokes(totalStrokes, nameElement);
          
          // 生成基于笔画的易经卦象
          const hexagram = generateHexagramFromStrokes(totalStrokes);
          
          // 获取基于笔画和五行的幸运元素
          const luckyElements = getLuckyElementsFromStrokes(totalStrokes, nameElement);
          
          // 生成运势分析文本
          const fortuneText = {
            baziAnalysis: `您的八字命盘与姓名五行(${nameElement})相互呼应，${totalStrokes}数显示您具有较强的${nameElement}属性特质，性格${nameElement === "金" ? "坚毅果断" : nameElement === "木" ? "温和坚韧" : nameElement === "水" ? "聪明灵活" : nameElement === "火" ? "热情开朗" : "稳重踏实"}。`,
            
            elementAnalysis: `您的命盘中${nameElement}气较为旺盛，表现为${nameElement === "金" ? "决断力强，做事有条理" : nameElement === "木" ? "创造力和进取心强，性格温和" : nameElement === "水" ? "思维灵活，善于沟通" : nameElement === "火" ? "热情洋溢，充满活力" : "踏实稳重，做事有始有终"}。建议通过五行相生相克原理来调节平衡。`,
            
            fortuneAnalysis: `基于您的姓名数理(${totalStrokes})分析，近期运势在${fortune.career > 85 ? "事业" : fortune.wealth > 85 ? "财富" : fortune.love > 85 ? "感情" : fortune.health > 85 ? "健康" : "人际"}方面表现最为突出。${hexagram.name}的卦象提示您${hexagram.analysis.substring(hexagram.name.length + 10)}`
          };
          
          // 更新结果
          safeUpdateElement('result-name', 'textContent', fullName);
          safeUpdateElement('result-date', 'textContent', `${year}年${month}月${day}日 ${hour}时`);
          
          // 更新八字
          safeUpdateElement('year-pillar', 'textContent', yearPillar.stem + yearPillar.branch);
          safeUpdateElement('month-pillar', 'textContent', monthPillar.stem + monthPillar.branch);
          safeUpdateElement('day-pillar', 'textContent', dayPillar.stem + dayPillar.branch);
          safeUpdateElement('hour-pillar', 'textContent', hourPillar.stem + hourPillar.branch);
          
          safeUpdateElement('year-element', 'textContent', stemElements[yearPillar.stem]);
          safeUpdateElement('year-element', 'className', `bazi-element element-${stemElements[yearPillar.stem]}`);
          
          safeUpdateElement('month-element', 'textContent', stemElements[monthPillar.stem]);
          safeUpdateElement('month-element', 'className', `bazi-element element-${stemElements[monthPillar.stem]}`);
          
          safeUpdateElement('day-element', 'textContent', stemElements[dayPillar.stem]);
          safeUpdateElement('day-element', 'className', `bazi-element element-${stemElements[dayPillar.stem]}`);
          
          safeUpdateElement('hour-element', 'textContent', stemElements[hourPillar.stem]);
          safeUpdateElement('hour-element', 'className', `bazi-element element-${stemElements[hourPillar.stem]}`);
          
          // 更新八字分析
          safeUpdateElement('bazi-analysis', 'textContent', fortuneText.baziAnalysis);
          
          // 更新五行分布
          safeUpdateElement('metal-percentage', 'textContent', elementPercentages["金"] + "%");
          safeUpdateElement('wood-percentage', 'textContent', elementPercentages["木"] + "%");
          safeUpdateElement('water-percentage', 'textContent', elementPercentages["水"] + "%");
          safeUpdateElement('fire-percentage', 'textContent', elementPercentages["火"] + "%");
          safeUpdateElement('earth-percentage', 'textContent', elementPercentages["土"] + "%");
          
          safeUpdateElement('five-element-analysis', 'textContent', fortuneText.elementAnalysis);
          
          // 更新姓名分析
          const nameGrid = document.getElementById('name-grid');
          nameGrid.innerHTML = '';
          for (let i = 0; i < fullName.length; i++) {
            const char = fullName[i];
            const strokes = nameAnalysis.strokes[i] || 0;
            
            const nameChar = document.createElement('div');
            nameChar.className = 'name-char';
            
            const charValue = document.createElement('div');
            charValue.className = 'char-value';
            charValue.textContent = char;
            
            const charStrokes = document.createElement('div');
            charStrokes.className = 'char-strokes';
            charStrokes.textContent = strokes + '画';
            
            nameChar.appendChild(charValue);
            nameChar.appendChild(charStrokes);
            nameGrid.appendChild(nameChar);
          }
          
          safeUpdateElement('name-score', 'textContent', nameAnalysis.score + '分');
          safeUpdateElement('name-analysis', 'textContent', nameAnalysis.analysis);
          
          // 更新星座分析
          safeUpdateElement('zodiac-analysis', 'textContent', `您属于${zodiac}，与您八字中的${stemElements[dayPillar.stem]}元素相互呼应，增强了您的特质。在事业方面，适合从事${dominantElement}相关的领域。`);
          
          // 更新运势图表
          safeUpdateElement('career-fortune', 'style.width', fortune.career + '%');
          safeUpdateElement('wealth-fortune', 'style.width', fortune.wealth + '%');
          safeUpdateElement('love-fortune', 'style.width', fortune.love + '%');
          safeUpdateElement('health-fortune', 'style.width', fortune.health + '%');
          safeUpdateElement('social-fortune', 'style.width', fortune.social + '%');
          
          safeUpdateElement('fortune-analysis', 'textContent', fortuneText.fortuneAnalysis);
          
          // 更新易经卦象
          try {
            safeUpdateElement('hexagram-name', 'textContent', hexagram.name);
            safeUpdateElement('hexagram-meaning', 'textContent', hexagram.meaning);
            safeUpdateElement('hexagram-analysis', 'textContent', hexagram.analysis);
            renderHexagram(hexagram.name);
          } catch (error) {
            console.error('渲染卦象时出错:', error);
            // 提供一个后备方案
            safeUpdateElement('hexagram-name', 'textContent', '未知卦象');
          }
          
          // 更新幸运元素
          safeUpdateElement('lucky-color', 'textContent', luckyElements.color);
          safeUpdateElement('lucky-number', 'textContent', luckyElements.number);
          safeUpdateElement('lucky-direction', 'textContent', luckyElements.direction);
          
          // 显示结果
          document.getElementById('result-container').style.display = 'block';
          
          // 滚动到结果部分
          document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
        } catch (error) {
          alert('生成运势时出错：' + error.message);
          document.getElementById('loading-container').style.display = 'none';
        }
      }, 1500);
    }
  </script>
</body>
</html> 